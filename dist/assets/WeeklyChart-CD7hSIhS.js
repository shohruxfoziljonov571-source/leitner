import{az as g,aA as tt,r as $,a as pt,e as ft,j as i,m as ht,s as mt}from"./index-CF1n9Zjo.js";import{i as vt,D as yt,f as xt,L as V,a as R,C as gt,A as bt,b as z,c as At,d as Y,h as jt,e as wt,G as kt,g as ot,j as et,u as Pt,E as St,k as Ot,l as _t,R as q,T as J,B as rt}from"./generateCategoricalChart-Wb5_xAQ8.js";import{X,Y as M,B as Dt,C as Z,A as Lt,a as Et}from"./AreaChart-BFv4T2ar.js";import{T as Nt}from"./trending-up-yagsvOF5.js";import{Z as Ct}from"./zap-BqAtVl3N.js";var Tt=["type","layout","connectNulls","ref"],It=["key"];function C(t){"@babel/helpers - typeof";return C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},C(t)}function at(t,a){if(t==null)return{};var r=Wt(t,a),e,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)e=s[n],!(a.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(t,e)&&(r[e]=t[e])}return r}function Wt(t,a){if(t==null)return{};var r={};for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){if(a.indexOf(e)>=0)continue;r[e]=t[e]}return r}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},K.apply(this,arguments)}function nt(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);a&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,e)}return r}function j(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?nt(Object(r),!0).forEach(function(e){S(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function N(t){return Ft(t)||Kt(t)||zt(t)||Bt()}function Bt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zt(t,a){if(t){if(typeof t=="string")return H(t,a);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(t,a)}}function Kt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ft(t){if(Array.isArray(t))return H(t)}function H(t,a){(a==null||a>t.length)&&(a=t.length);for(var r=0,e=new Array(a);r<a;r++)e[r]=t[r];return e}function Rt(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function it(t,a){for(var r=0;r<a.length;r++){var e=a[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,lt(e.key),e)}}function $t(t,a,r){return a&&it(t.prototype,a),r&&it(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Xt(t,a,r){return a=G(a),Mt(t,st()?Reflect.construct(a,r||[],G(t).constructor):a.apply(t,r))}function Mt(t,a){if(a&&(C(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gt(t)}function Gt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function st(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(st=function(){return!!t})()}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},G(t)}function Ut(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&Q(t,a)}function Q(t,a){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},Q(t,a)}function S(t,a,r){return a=lt(a),a in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function lt(t){var a=Vt(t,"string");return C(a)=="symbol"?a:a+""}function Vt(t,a){if(C(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var e=r.call(t,a||"default");if(C(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}var T=function(t){function a(){var r;Rt(this,a);for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return r=Xt(this,a,[].concat(n)),S(r,"state",{isAnimationFinished:!0,totalLength:0}),S(r,"generateSimpleStrokeDasharray",function(o,l){return"".concat(l,"px ").concat(o-l,"px")}),S(r,"getStrokeDasharray",function(o,l,p){var h=p.reduce(function(b,w){return b+w});if(!h)return r.generateSimpleStrokeDasharray(l,o);for(var v=Math.floor(o/h),u=o%h,d=l-o,f=[],c=0,m=0;c<p.length;m+=p[c],++c)if(m+p[c]>u){f=[].concat(N(p.slice(0,c)),[u-m]);break}var x=f.length%2===0?[0,d]:[d];return[].concat(N(a.repeat(p,v)),N(f),x).map(function(b){return"".concat(b,"px")}).join(", ")}),S(r,"id",Pt("recharts-line-")),S(r,"pathRef",function(o){r.mainCurve=o}),S(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),S(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Ut(a,t),$t(a,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();this.setState({totalLength:e})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();e!==this.state.totalLength&&this.setState({totalLength:e})}}},{key:"getTotalLength",value:function(){var e=this.mainCurve;try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(e,n){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var s=this.props,o=s.points,l=s.xAxis,p=s.yAxis,h=s.layout,v=s.children,u=xt(v,St);if(!u)return null;var d=function(m,x){return{x:m.x,y:m.y,value:m.value,errorVal:ot(m.payload,x)}},f={clipPath:e?"url(#clipPath-".concat(n,")"):null};return g.createElement(V,f,u.map(function(c){return g.cloneElement(c,{key:"bar-".concat(c.props.dataKey),data:o,xAxis:l,yAxis:p,layout:h,dataPointFormatter:d})}))}},{key:"renderDots",value:function(e,n,s){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var l=this.props,p=l.dot,h=l.points,v=l.dataKey,u=R(this.props,!1),d=R(p,!0),f=h.map(function(m,x){var b=j(j(j({key:"dot-".concat(x),r:3},u),d),{},{index:x,cx:m.x,cy:m.y,value:m.value,dataKey:v,payload:m.payload,points:h});return a.renderDotItem(p,b)}),c={clipPath:e?"url(#clipPath-".concat(n?"":"dots-").concat(s,")"):null};return g.createElement(V,K({className:"recharts-line-dots",key:"dots"},c),f)}},{key:"renderCurveStatically",value:function(e,n,s,o){var l=this.props,p=l.type,h=l.layout,v=l.connectNulls;l.ref;var u=at(l,Tt),d=j(j(j({},R(u,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:n?"url(#clipPath-".concat(s,")"):null,points:e},o),{},{type:p,layout:h,connectNulls:v});return g.createElement(gt,K({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(e,n){var s=this,o=this.props,l=o.points,p=o.strokeDasharray,h=o.isAnimationActive,v=o.animationBegin,u=o.animationDuration,d=o.animationEasing,f=o.animationId,c=o.animateNewValues,m=o.width,x=o.height,b=this.state,w=b.prevPoints,_=b.totalLength;return g.createElement(bt,{begin:v,duration:u,isActive:h,easing:d,from:{t:0},to:{t:1},key:"line-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(k){var P=k.t;if(w){var y=w.length/l.length,O=l.map(function(A,U){var W=Math.floor(U*y);if(w[W]){var B=w[W],E=z(B.x,A.x),ct=z(B.y,A.y);return j(j({},A),{},{x:E(P),y:ct(P)})}if(c){var ut=z(m*2,A.x),dt=z(x/2,A.y);return j(j({},A),{},{x:ut(P),y:dt(P)})}return j(j({},A),{},{x:A.x,y:A.y})});return s.renderCurveStatically(O,e,n)}var D=z(0,_),L=D(P),I;if(p){var F="".concat(p).split(/[,\s]+/gim).map(function(A){return parseFloat(A)});I=s.getStrokeDasharray(L,_,F)}else I=s.generateSimpleStrokeDasharray(_,L);return s.renderCurveStatically(l,e,n,{strokeDasharray:I})})}},{key:"renderCurve",value:function(e,n){var s=this.props,o=s.points,l=s.isAnimationActive,p=this.state,h=p.prevPoints,v=p.totalLength;return l&&o&&o.length&&(!h&&v>0||!At(h,o))?this.renderCurveWithAnimation(e,n):this.renderCurveStatically(o,e,n)}},{key:"render",value:function(){var e,n=this.props,s=n.hide,o=n.dot,l=n.points,p=n.className,h=n.xAxis,v=n.yAxis,u=n.top,d=n.left,f=n.width,c=n.height,m=n.isAnimationActive,x=n.id;if(s||!l||!l.length)return null;var b=this.state.isAnimationFinished,w=l.length===1,_=tt("recharts-line",p),k=h&&h.allowDataOverflow,P=v&&v.allowDataOverflow,y=k||P,O=Y(x)?this.id:x,D=(e=R(o,!1))!==null&&e!==void 0?e:{r:3,strokeWidth:2},L=D.r,I=L===void 0?3:L,F=D.strokeWidth,A=F===void 0?2:F,U=jt(o)?o:{},W=U.clipDot,B=W===void 0?!0:W,E=I*2+A;return g.createElement(V,{className:_},k||P?g.createElement("defs",null,g.createElement("clipPath",{id:"clipPath-".concat(O)},g.createElement("rect",{x:k?d:d-f/2,y:P?u:u-c/2,width:k?f:f*2,height:P?c:c*2})),!B&&g.createElement("clipPath",{id:"clipPath-dots-".concat(O)},g.createElement("rect",{x:d-E/2,y:u-E/2,width:f+E,height:c+E}))):null,!w&&this.renderCurve(y,O),this.renderErrorBar(y,O),(w||o)&&this.renderDots(y,B,O),(!m||b)&&wt.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(e,n){return e.animationId!==n.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:n.curPoints}:e.points!==n.curPoints?{curPoints:e.points}:null}},{key:"repeat",value:function(e,n){for(var s=e.length%2!==0?[].concat(N(e),[0]):e,o=[],l=0;l<n;++l)o=[].concat(N(o),N(s));return o}},{key:"renderDotItem",value:function(e,n){var s;if(g.isValidElement(e))s=g.cloneElement(e,n);else if(vt(e))s=e(n);else{var o=n.key,l=at(n,It),p=tt("recharts-line-dot",typeof e!="boolean"?e.className:"");s=g.createElement(yt,K({key:o},l,{className:p}))}return s}}])}($.PureComponent);S(T,"displayName","Line");S(T,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!kt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});S(T,"getComposedData",function(t){var a=t.props,r=t.xAxis,e=t.yAxis,n=t.xAxisTicks,s=t.yAxisTicks,o=t.dataKey,l=t.bandSize,p=t.displayedData,h=t.offset,v=a.layout,u=p.map(function(d,f){var c=ot(d,o);return v==="horizontal"?{x:et({axis:r,ticks:n,bandSize:l,entry:d,index:f}),y:Y(c)?null:e.scale(c),value:c,payload:d}:{x:Y(c)?null:r.scale(c),y:et({axis:e,ticks:s,bandSize:l,entry:d,index:f}),value:c,payload:d}});return j({points:u,layout:v},h)});var qt=Ot({chartName:"LineChart",GraphicalChild:T,axisComponents:[{axisType:"xAxis",AxisComp:X},{axisType:"yAxis",AxisComp:M}],formatAxisMap:_t});const te=()=>{const[t,a]=$.useState([]),[r,e]=$.useState("activity"),{user:n}=pt(),{activeLanguage:s}=ft();$.useEffect(()=>{(async()=>{if(!n||!s)return;const d=new Date,f=new Date(d);f.setDate(f.getDate()-6);try{const{data:c,error:m}=await mt.from("daily_stats").select("*").eq("user_id",n.id).eq("user_language_id",s.id).gte("date",f.toISOString().split("T")[0]).order("date",{ascending:!0});if(m)throw m;const x=[];let b=0,w=0;for(let _=0;_<7;_++){const k=new Date(f);k.setDate(k.getDate()+_);const P=k.toISOString().split("T")[0],y=c==null?void 0:c.find(L=>L.date===P),O=(y==null?void 0:y.words_reviewed)||0,D=(y==null?void 0:y.xp_earned)||0;b+=O,w+=D,x.push({date:k.toLocaleDateString("uz-UZ",{weekday:"short"}),fullDate:k.toLocaleDateString("uz-UZ",{day:"numeric",month:"short"}),words_reviewed:O,words_correct:(y==null?void 0:y.words_correct)||0,xp_earned:D,cumulative_words:b,cumulative_xp:w})}a(x)}catch(c){console.error("Error fetching weekly data:",c)}})()},[n,s]);const o=({active:u,payload:d,label:f})=>u&&d&&d.length?i.jsxs("div",{className:"bg-card p-3 rounded-xl shadow-elevated border border-border",children:[i.jsx("p",{className:"font-semibold text-foreground mb-1",children:f}),d.map((c,m)=>i.jsxs("p",{className:"text-sm",style:{color:c.color},children:[c.name,": ",c.value]},m))]}):null,l=t.reduce((u,d)=>u+d.words_reviewed,0),p=t.reduce((u,d)=>u+d.xp_earned,0),h=t.length>0?Math.round(l/t.length):0,v=[{id:"activity",label:"Faollik",icon:null},{id:"growth",label:"O'sish",icon:Nt},{id:"xp",label:"XP",icon:Ct}];return i.jsxs(ht.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-3xl shadow-card p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"font-display font-semibold text-lg",children:"Haftalik statistika"}),i.jsx("div",{className:"flex gap-1 bg-muted rounded-xl p-1",children:v.map(u=>i.jsxs("button",{onClick:()=>e(u.id),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all flex items-center gap-1 ${r===u.id?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"}`,children:[u.icon&&i.jsx(u.icon,{className:"w-3 h-3"}),u.label]},u.id))})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-xl",children:[i.jsx("p",{className:"font-bold text-lg text-primary",children:l}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Jami takror"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-xl",children:[i.jsx("p",{className:"font-bold text-lg text-primary",children:h}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"O'rtacha/kun"})]}),i.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-xl",children:[i.jsx("p",{className:"font-bold text-lg text-primary",children:p}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Jami XP"})]})]}),i.jsxs("div",{className:"h-[180px]",children:[r==="activity"&&i.jsx(q,{width:"100%",height:"100%",children:i.jsxs(Dt,{data:t,children:[i.jsx(Z,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),i.jsx(X,{dataKey:"date",tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"}}),i.jsx(M,{tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"}}),i.jsx(J,{content:i.jsx(o,{})}),i.jsx(rt,{dataKey:"words_reviewed",fill:"hsl(var(--primary))",radius:[4,4,0,0],name:"Takrorlar"}),i.jsx(rt,{dataKey:"words_correct",fill:"hsl(var(--primary) / 0.4)",radius:[4,4,0,0],name:"To'g'ri"})]})}),r==="growth"&&i.jsx(q,{width:"100%",height:"100%",children:i.jsxs(Lt,{data:t,children:[i.jsx("defs",{children:i.jsxs("linearGradient",{id:"colorGrowth",x1:"0",y1:"0",x2:"0",y2:"1",children:[i.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),i.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),i.jsx(Z,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),i.jsx(X,{dataKey:"date",tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"}}),i.jsx(M,{tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"}}),i.jsx(J,{content:i.jsx(o,{})}),i.jsx(Et,{type:"monotone",dataKey:"cumulative_words",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#colorGrowth)",name:"Jami takrorlar"})]})}),r==="xp"&&i.jsx(q,{width:"100%",height:"100%",children:i.jsxs(qt,{data:t,children:[i.jsx(Z,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),i.jsx(X,{dataKey:"date",tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"}}),i.jsx(M,{tick:{fill:"hsl(var(--muted-foreground))",fontSize:11},axisLine:{stroke:"hsl(var(--border))"}}),i.jsx(J,{content:i.jsx(o,{})}),i.jsx(T,{type:"monotone",dataKey:"xp_earned",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))",strokeWidth:2,r:4},activeDot:{r:6,fill:"hsl(var(--primary))"},name:"XP"}),i.jsx(T,{type:"monotone",dataKey:"cumulative_xp",stroke:"hsl(var(--secondary))",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"Jami XP"})]})})]})]})};export{te as default};
