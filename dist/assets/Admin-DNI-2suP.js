import{c as _,a as xe,r as l,s as n,j as e,a8 as me,m as ue,U as X,f as je,B as u,P as $,b as v}from"./index-H5eLpdEA.js";import{T as ge,a as fe,b as P,c as H,C as o,d as h,e as F,f as G}from"./tabs-DZIfP3P_.js";import{I as y}from"./input-CTxYhRwj.js";import{L as N}from"./label-B269C1Du.js";import{D as J,a as Q,b as Z,c as ee,d as se}from"./dialog-DtFkyyB7.js";import{T as V}from"./trending-up-C2EPqjgO.js";import{C as pe}from"./calendar-CiKTSD-o.js";import{R as ae,T as re,B as te}from"./generateCategoricalChart-Dij2mMTD.js";import{A as ve,C as ne,X as le,Y as ce,a as ye,B as Ne}from"./AreaChart-LUUEs459.js";import{E as we}from"./external-link-rwsGInr4.js";import{T as ie}from"./trash-2-CThAXJrU.js";import{C as _e}from"./copy-D_y_CB_W.js";import"./index-DuMAhUlO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=_("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=_("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=_("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=_("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=_("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=_("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Te=()=>{const{user:k}=xe(),[i,r]=l.useState(!1),[S,b]=l.useState(!0),[R,q]=l.useState(null),[z,U]=l.useState([]),[A,L]=l.useState([]),[O,c]=l.useState([]),g=l.useCallback(async()=>{if(!k){r(!1),b(!1);return}try{const{data:s,error:a}=await n.rpc("has_role",{_user_id:k.id,_role:"admin"});if(a)throw a;r(s===!0)}catch(s){console.error("Error checking admin status:",s),r(!1)}finally{b(!1)}},[k]),d=l.useCallback(async()=>{if(i)try{const s=new Date().toISOString().split("T")[0],a=new Date(Date.now()-7*24*60*60*1e3).toISOString().split("T")[0],[{count:t},{count:x},{count:m},{data:C},{count:T}]=await Promise.all([n.from("profiles").select("*",{count:"exact",head:!0}),n.from("user_stats").select("*",{count:"exact",head:!0}).eq("last_active_date",s),n.from("words").select("*",{count:"exact",head:!0}),n.from("user_stats").select("today_reviewed"),n.from("profiles").select("*",{count:"exact",head:!0}).gte("created_at",a)]),E=(C==null?void 0:C.reduce((W,Y)=>W+(Y.today_reviewed||0),0))||0;q({totalUsers:t||0,activeToday:x||0,totalWords:m||0,totalReviews:E,newUsersThisWeek:T||0,avgWordsPerUser:t?Math.round((m||0)/t):0})}catch(s){console.error("Error fetching admin stats:",s)}},[i]),p=l.useCallback(async()=>{if(i)try{const a=[];for(let t=13;t>=0;t--){const x=new Date(Date.now()-t*24*60*60*1e3),m=x.toISOString().split("T")[0],[{count:C},{data:T},{count:E}]=await Promise.all([n.from("profiles").select("*",{count:"exact",head:!0}).gte("created_at",m).lt("created_at",new Date(x.getTime()+24*60*60*1e3).toISOString().split("T")[0]),n.from("daily_stats").select("words_reviewed").eq("date",m),n.from("words").select("*",{count:"exact",head:!0}).gte("created_at",m).lt("created_at",new Date(x.getTime()+24*60*60*1e3).toISOString().split("T")[0])]);a.push({date:m,users:C||0,reviews:(T==null?void 0:T.reduce((W,Y)=>W+(Y.words_reviewed||0),0))||0,newWords:E||0})}c(a)}catch(s){console.error("Error fetching daily stats:",s)}},[i]),f=l.useCallback(async()=>{if(i)try{const{data:s,error:a}=await n.from("required_channels").select("*").order("created_at",{ascending:!1});if(a)throw a;U(s||[])}catch(s){console.error("Error fetching channels:",s)}},[i]),j=l.useCallback(async()=>{if(i)try{const{data:s,error:a}=await n.from("referrals").select("*").order("created_at",{ascending:!1});if(a)throw a;L(s||[])}catch(s){console.error("Error fetching referrals:",s)}},[i]),I=async s=>{try{const{error:a}=await n.from("required_channels").insert({channel_id:s.channel_id,channel_name:s.channel_name,channel_username:s.channel_username,channel_url:s.channel_url,is_active:!0});if(a)throw a;return await f(),{success:!0}}catch(a){return{success:!1,error:a.message}}},D=async(s,a)=>{try{const{error:t}=await n.from("required_channels").update({is_active:a}).eq("id",s);if(t)throw t;return await f(),{success:!0}}catch(t){return{success:!1,error:t.message}}},K=async s=>{try{const{error:a}=await n.from("required_channels").delete().eq("id",s);if(a)throw a;return await f(),{success:!0}}catch(a){return{success:!1,error:a.message}}},M=async s=>{try{const{error:a}=await n.from("referrals").insert({code:s.code,name:s.name,description:s.description||null,is_active:!0});if(a)throw a;return await j(),{success:!0}}catch(a){return{success:!1,error:a.message}}},B=async(s,a)=>{try{const{error:t}=await n.from("referrals").update({is_active:a}).eq("id",s);if(t)throw t;return await j(),{success:!0}}catch(t){return{success:!1,error:t.message}}},w=async s=>{try{const{error:a}=await n.from("referrals").delete().eq("id",s);if(a)throw a;return await j(),{success:!0}}catch(a){return{success:!1,error:a.message}}};return l.useEffect(()=>{g()},[g]),l.useEffect(()=>{i&&(d(),f(),j(),p())},[i,d,f,j,p]),{isAdmin:i,isLoading:S,stats:R,channels:z,referrals:A,dailyStats:O,addChannel:I,toggleChannel:D,deleteChannel:K,addReferral:M,toggleReferral:B,deleteReferral:w,refreshStats:d,refreshChannels:f,refreshReferrals:j}},Ee=()=>{const{isAdmin:k,isLoading:i,stats:r,channels:S,referrals:b,dailyStats:R,addChannel:q,toggleChannel:z,deleteChannel:U,addReferral:A,toggleReferral:L,deleteReferral:O}=Te(),[c,g]=l.useState({channel_id:"",channel_name:"",channel_username:"",channel_url:""}),[d,p]=l.useState({code:"",name:"",description:""}),[f,j]=l.useState(!1),[I,D]=l.useState(!1);if(i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Yuklanmoqda..."})});if(!k)return e.jsx(me,{to:"/",replace:!0});const K=async()=>{if(!c.channel_id||!c.channel_name||!c.channel_username){v.error("Barcha maydonlarni to'ldiring");return}const s=await q(c);s.success?(v.success("Kanal qo'shildi"),g({channel_id:"",channel_name:"",channel_username:"",channel_url:""}),j(!1)):v.error(s.error||"Xatolik yuz berdi")},M=async()=>{if(!d.code||!d.name){v.error("Kod va nom kiritilishi shart");return}const s=await A(d);s.success?(v.success("Referral qo'shildi"),p({code:"",name:"",description:""}),D(!1)):v.error(s.error||"Xatolik yuz berdi")},B=s=>{const a=`https://t.me/leitner_study_bot?start=ref_${s}`;navigator.clipboard.writeText(a),v.success("URL nusxalandi")},w=s=>new Date(s).toLocaleDateString("uz-UZ",{month:"short",day:"numeric"});return e.jsx("div",{className:"min-h-screen bg-background pb-24",children:e.jsxs("div",{className:"container max-w-4xl mx-auto px-4 py-6",children:[e.jsxs(ue.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ce,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Admin Panel"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Bot va foydalanuvchilar statistikasi"})]}),e.jsxs(ge,{defaultValue:"analytics",className:"space-y-6",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3",children:[e.jsxs(P,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Analitika"]}),e.jsxs(P,{value:"channels",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Kanallar"]}),e.jsxs(P,{value:"referrals",className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Referrallar"]})]}),e.jsxs(H,{value:"analytics",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(X,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalUsers)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Jami foydalanuvchilar"})]})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(V,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.activeToday)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bugun faol"})]})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(je,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalWords)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Jami so'zlar"})]})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500/10",children:e.jsx(pe,{className:"h-5 w-5 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.newUsersThisWeek)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Yangi (7 kun)"})]})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(de,{className:"h-5 w-5 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.avgWordsPerUser)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O'rtacha so'z/user"})]})]})})}),e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-pink-500/10",children:e.jsx(V,{className:"h-5 w-5 text-pink-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalReviews)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bugungi takrorlar"})]})]})})})]}),e.jsxs(o,{children:[e.jsx(F,{children:e.jsx(G,{className:"text-lg",children:"Kunlik faollik (14 kun)"})}),e.jsx(h,{children:e.jsx("div",{className:"h-64",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(ve,{data:R,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorUsers",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(le,{dataKey:"date",tickFormatter:w,className:"text-xs"}),e.jsx(ce,{className:"text-xs"}),e.jsx(re,{content:({active:s,payload:a,label:t})=>{var x;return s&&a&&a.length?e.jsxs("div",{className:"bg-popover p-3 rounded-lg shadow-lg border",children:[e.jsx("p",{className:"font-medium",children:w(t)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Yangi foydalanuvchilar: ",(x=a[0])==null?void 0:x.value]})]}):null}}),e.jsx(ye,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",fillOpacity:1,fill:"url(#colorUsers)"})]})})})})]}),e.jsxs(o,{children:[e.jsx(F,{children:e.jsx(G,{className:"text-lg",children:"Takrorlar va yangi so'zlar"})}),e.jsx(h,{children:e.jsx("div",{className:"h-64",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(Ne,{data:R,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(le,{dataKey:"date",tickFormatter:w,className:"text-xs"}),e.jsx(ce,{className:"text-xs"}),e.jsx(re,{content:({active:s,payload:a,label:t})=>{var x,m;return s&&a&&a.length?e.jsxs("div",{className:"bg-popover p-3 rounded-lg shadow-lg border",children:[e.jsx("p",{className:"font-medium",children:w(t)}),e.jsxs("p",{className:"text-sm text-green-500",children:["Takrorlar: ",(x=a[0])==null?void 0:x.value]}),e.jsxs("p",{className:"text-sm text-blue-500",children:["Yangi so'zlar: ",(m=a[1])==null?void 0:m.value]})]}):null}}),e.jsx(te,{dataKey:"reviews",fill:"hsl(142, 76%, 36%)",radius:[4,4,0,0]}),e.jsx(te,{dataKey:"newWords",fill:"hsl(217, 91%, 60%)",radius:[4,4,0,0]})]})})})})]})]}),e.jsxs(H,{value:"channels",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Majburiy kanallar"}),e.jsxs(J,{open:f,onOpenChange:j,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(u,{size:"sm",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Kanal qo'shish"]})}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Yangi kanal qo'shish"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Kanal ID"}),e.jsx(y,{value:c.channel_id,onChange:s=>g({...c,channel_id:s.target.value}),placeholder:"-1001234567890"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Kanal nomi"}),e.jsx(y,{value:c.channel_name,onChange:s=>g({...c,channel_name:s.target.value}),placeholder:"Leitner Study"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Username"}),e.jsx(y,{value:c.channel_username,onChange:s=>g({...c,channel_username:s.target.value}),placeholder:"leitner_study"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"URL"}),e.jsx(y,{value:c.channel_url,onChange:s=>g({...c,channel_url:s.target.value}),placeholder:"https://t.me/leitner_study"})]}),e.jsx(u,{onClick:K,className:"w-full",children:"Qo'shish"})]})]})]})]}),S.length===0?e.jsx(o,{children:e.jsx(h,{className:"p-8 text-center text-muted-foreground",children:"Hali kanallar qo'shilmagan"})}):e.jsx("div",{className:"space-y-3",children:S.map(s=>e.jsx(o,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.is_active?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.channel_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",s.channel_username]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>window.open(s.channel_url,"_blank"),children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>z(s.id,!s.is_active),children:s.is_active?e.jsx(he,{className:"h-5 w-5 text-green-500"}):e.jsx(oe,{className:"h-5 w-5 text-gray-400"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>U(s.id),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]})]})})},s.id))})]}),e.jsxs(H,{value:"referrals",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Referral linklar"}),e.jsxs(J,{open:I,onOpenChange:D,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(u,{size:"sm",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Referral qo'shish"]})}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Yangi referral yaratish"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Kod (URL uchun)"}),e.jsx(y,{value:d.code,onChange:s=>p({...d,code:s.target.value.toLowerCase().replace(/\s/g,"_")}),placeholder:"instagram_jan2026"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Nomi"}),e.jsx(y,{value:d.name,onChange:s=>p({...d,name:s.target.value}),placeholder:"Instagram reklama - Yanvar 2026"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Izoh (ixtiyoriy)"}),e.jsx(y,{value:d.description,onChange:s=>p({...d,description:s.target.value}),placeholder:"@shohruxdigital orqali"})]}),e.jsx(u,{onClick:M,className:"w-full",children:"Yaratish"})]})]})]})]}),b.length===0?e.jsx(o,{children:e.jsx(h,{className:"p-8 text-center text-muted-foreground",children:"Hali referrallar yaratilmagan"})}):e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsx(o,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.is_active?"bg-green-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>B(s.code),children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>L(s.id,!s.is_active),children:s.is_active?e.jsx(he,{className:"h-5 w-5 text-green-500"}):e.jsx(oe,{className:"h-5 w-5 text-gray-400"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>O(s.id),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{children:[s.clicks," bosish"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:[s.registrations," ro'yxat"]})]}),e.jsxs("div",{className:"text-muted-foreground",children:["Konversiya: ",s.clicks>0?Math.round(s.registrations/s.clicks*100):0,"%"]})]}),e.jsxs("div",{className:"mt-2 p-2 bg-muted rounded text-xs font-mono break-all",children:["https://t.me/leitner_study_bot?start=ref_",s.code]})]})},s.id))})]})]})]})})};export{Ee as default};
