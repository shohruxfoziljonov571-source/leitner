import{c as p,u as ee,a as ae,r as d,s as h,j as e,m as g,B as u,h as se,X as re,b as n}from"./index-H5eLpdEA.js";import{I as M}from"./input-CTxYhRwj.js";import{L as w}from"./label-B269C1Du.js";import{T as te,S as le,a as ie,b as ne,c as ce,d as o}from"./select-DFHayVz_.js";import{a as oe,B as de,S as me}from"./switch-CtfY_V3O.js";import{A as $,a as A,b as I}from"./avatar-DgHjWyI7.js";import{B as he}from"./badge-4vPmJYcu.js";import{L as R}from"./loader-circle-CZ1hHvJY.js";import{U as ue}from"./user-BPHk8Q2t.js";import{C as xe}from"./clock-C2GG-cMG.js";import{E as ge}from"./external-link-rwsGInr4.js";import{C as fe}from"./copy-D_y_CB_W.js";import"./index-tqWPnzjf.js";import"./chevron-down-dSV5BqrI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=p("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=p("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=p("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=p("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),P="Leitner_robot",Me=()=>{var E,L;ee();const{user:r,isTelegramUser:c,telegramUser:l}=ae(),[s,F]=d.useState(null),[i,y]=d.useState(null),[H,U]=d.useState(!0),[T,C]=d.useState(!1),[b,S]=d.useState(""),[q,z]=d.useState(""),[V,v]=d.useState(!1),[B,X]=d.useState("");d.useEffect(()=>{r&&(f(),N())},[r]);const f=async()=>{try{const{data:a,error:t}=await h.from("profiles").select("full_name, bio, avatar_url, telegram_chat_id, telegram_username, telegram_connected_at").eq("user_id",r.id).maybeSingle();if(t)throw t;a&&(F(a),S(a.full_name||""),z(a.bio||""))}catch(a){console.error("Error fetching profile:",a)}finally{U(!1)}},N=async()=>{try{const{data:a,error:t}=await h.from("notification_settings").select("telegram_enabled, daily_reminder_time").eq("user_id",r.id).maybeSingle();if(t&&t.code!=="PGRST116")throw t;y(a||{telegram_enabled:!1,daily_reminder_time:"09:00"})}catch(a){console.error("Error fetching notification settings:",a)}},D=async()=>{if(r){C(!0);try{const{error:a}=await h.from("profiles").update({full_name:b.trim()||null,bio:q.trim()||null}).eq("user_id",r.id);if(a)throw a;n.success("Profil saqlandi!"),f()}catch(a){console.error("Error saving profile:",a),n.error("Xatolik yuz berdi")}finally{C(!1)}}},O=async a=>{if(r)try{const{error:t}=await h.from("notification_settings").upsert({user_id:r.id,telegram_enabled:a},{onConflict:"user_id"});if(t)throw t;y(x=>x?{...x,telegram_enabled:a}:null),n.success(a?"Bildirishnomalar yoqildi":"Bildirishnomalar o'chirildi")}catch(t){console.error("Error updating notification settings:",t),n.error("Xatolik yuz berdi")}},G=async a=>{if(r)try{const{error:t}=await h.from("notification_settings").upsert({user_id:r.id,daily_reminder_time:a},{onConflict:"user_id"});if(t)throw t;y(x=>x?{...x,daily_reminder_time:a}:null),n.success(`Eslatma vaqti ${a} ga o'zgartirildi`)}catch(t){console.error("Error updating reminder time:",t),n.error("Xatolik yuz berdi")}},Q=()=>{const a=btoa(`${r==null?void 0:r.id}:${Date.now()}`);return{url:`https://t.me/${P}?start=${a}`,command:`/start ${a}`}},Z=()=>{const{url:a,command:t}=Q();X(t),v(!0),window.open(a,"_blank"),n.info("Telegram bot ochildi. Quyidagi buyruqni botga yuboring.")},J=()=>{navigator.clipboard.writeText(B),n.success("Nusxalandi! Endi Telegram botga yuboring.")},K=async()=>{await f(),await N(),s!=null&&s.telegram_chat_id?(n.success("Telegram ulandi!"),v(!1)):n.info("Hali ulanmagan. Buyruqni botga yubordingizmi?")},W=async()=>{if(r&&confirm("Telegram ulanishini uzmoqchimisiz?"))try{const{error:a}=await h.from("profiles").update({telegram_chat_id:null,telegram_username:null,telegram_connected_at:null}).eq("user_id",r.id);if(a)throw a;await h.from("notification_settings").update({telegram_enabled:!1}).eq("user_id",r.id),n.success("Telegram uzildi"),f(),N()}catch(a){console.error("Error disconnecting Telegram:",a),n.error("Xatolik yuz berdi")}},Y=()=>{window.open(`https://t.me/${P}`,"_blank")};if(H)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(R,{className:"w-8 h-8 animate-spin text-primary"})});const _=!!(s!=null&&s.telegram_chat_id),j=(s==null?void 0:s.avatar_url)||c&&(l==null?void 0:l.photo_url),m=b||(s==null?void 0:s.full_name)||(c&&l?`${l.first_name}${l.last_name?" "+l.last_name:""}`:"");return e.jsx("div",{className:"min-h-screen pb-24 md:pt-24 md:pb-8",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-lg",children:[e.jsxs(g.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"font-display font-bold text-3xl text-foreground mb-2",children:"Profil ðŸ‘¤"}),e.jsx("p",{className:"text-muted-foreground",children:"Shaxsiy ma'lumotlaringiz"})]}),e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"flex flex-col items-center mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsxs($,{className:"w-24 h-24 border-4 border-primary/20 shadow-elevated",children:[j?e.jsx(A,{src:j,alt:m}):null,e.jsx(I,{className:"gradient-primary text-primary-foreground text-3xl",children:m?m.charAt(0).toUpperCase():e.jsx(ue,{className:"w-12 h-12"})})]}),!c&&e.jsx("button",{className:"absolute bottom-0 right-0 w-8 h-8 bg-card rounded-full shadow-card flex items-center justify-center hover:bg-muted transition-colors",children:e.jsx(je,{className:"w-4 h-4 text-muted-foreground"})})]}),c&&l&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs(he,{variant:"secondary",className:"bg-[#0088cc]/10 text-[#0088cc] gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),"Telegram orqali"]}),l.username&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["@",l.username]})]})]}),e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"bg-card rounded-2xl shadow-card p-5 mb-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"email",children:"Email"}),e.jsx(M,{id:"email",value:(r==null?void 0:r.email)||"",disabled:!0,className:"bg-muted"}),c&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Telegram orqali avtomatik yaratilgan"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"fullName",children:"Ism"}),e.jsx(M,{id:"fullName",value:b,onChange:a=>S(a.target.value),placeholder:"Ismingizni kiriting",maxLength:100})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"bio",children:"Bio"}),e.jsx(te,{id:"bio",value:q,onChange:a=>z(a.target.value),placeholder:"O'zingiz haqingizda yozing...",maxLength:500,className:"min-h-[80px]"})]}),e.jsxs(u,{onClick:D,disabled:T,className:"w-full gap-2 gradient-primary text-primary-foreground",children:[T?e.jsx(R,{className:"w-4 h-4 animate-spin"}):e.jsx(ye,{className:"w-4 h-4"}),"Saqlash"]})]}),e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-2xl shadow-card p-5 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-[#0088cc]/10 flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-[#0088cc]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:"Telegram"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s!=null&&s.telegram_username?`@${s.telegram_username} ulangan`:c&&(l!=null&&l.username)?`@${l.username} (avtomatik)`:"Bildirishnomalar uchun ulang"})]}),(_||c)&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500/10 flex items-center justify-center",children:e.jsx(se,{className:"w-4 h-4 text-green-500"})})]}),_||c?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-[#0088cc]/5 rounded-xl border border-[#0088cc]/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs($,{className:"w-10 h-10",children:[j&&e.jsx(A,{src:j}),e.jsx(I,{className:"bg-[#0088cc] text-white",children:((E=m==null?void 0:m.charAt(0))==null?void 0:E.toUpperCase())||"T"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:m||"Telegram foydalanuvchi"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",(s==null?void 0:s.telegram_username)||(l==null?void 0:l.username)||"username"]})]})]}),(s==null?void 0:s.telegram_connected_at)&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ulangan: ",new Date(s.telegram_connected_at).toLocaleDateString("uz-UZ",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i!=null&&i.telegram_enabled?e.jsx(oe,{className:"w-5 h-5 text-primary"}):e.jsx(de,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Telegram bildirishnomalar"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Takrorlash eslatmalari"})]})]}),e.jsx(me,{checked:(i==null?void 0:i.telegram_enabled)||!1,onCheckedChange:O})]}),(_||c)&&(i==null?void 0:i.telegram_enabled)&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Eslatma vaqti"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Har kuni shu vaqtda eslatma"})]})]}),e.jsxs(le,{value:((L=i==null?void 0:i.daily_reminder_time)==null?void 0:L.slice(0,5))||"09:00",onValueChange:G,children:[e.jsx(ie,{className:"w-24",children:e.jsx(ne,{})}),e.jsxs(ce,{children:[e.jsx(o,{value:"06:00",children:"ðŸŒ… 06:00"}),e.jsx(o,{value:"07:00",children:"ðŸŒ„ 07:00"}),e.jsx(o,{value:"08:00",children:"ðŸŒ„ 08:00"}),e.jsx(o,{value:"09:00",children:"ðŸŒ… 09:00"}),e.jsx(o,{value:"10:00",children:"â˜€ï¸ 10:00"}),e.jsx(o,{value:"12:00",children:"â˜€ï¸ 12:00"}),e.jsx(o,{value:"14:00",children:"ðŸŒ¤ï¸ 14:00"}),e.jsx(o,{value:"18:00",children:"ðŸŒ† 18:00"}),e.jsx(o,{value:"20:00",children:"ðŸŒ™ 20:00"}),e.jsx(o,{value:"21:00",children:"ðŸŒ™ 21:00"})]})]})]}),e.jsxs(u,{variant:"outline",onClick:Y,className:"w-full gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Bot orqali sozlash"]}),!c&&e.jsxs(u,{variant:"outline",onClick:W,className:"w-full gap-2 border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(re,{className:"w-4 h-4"}),"Uzish"]})]}):e.jsx("div",{className:"space-y-3",children:V?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 bg-muted rounded-xl",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Bu buyruqni Telegram botga yuboring:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-background p-2 rounded text-xs font-mono break-all",children:B}),e.jsx(u,{size:"icon",variant:"outline",onClick:J,className:"shrink-0",children:e.jsx(fe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"Bekor qilish"}),e.jsxs(u,{onClick:K,className:"flex-1 gap-2 bg-[#0088cc] hover:bg-[#0088cc]/90 text-white",children:[e.jsx(pe,{className:"w-4 h-4"}),"Tekshirish"]})]})]}):e.jsxs(u,{onClick:Z,className:"w-full gap-2 bg-[#0088cc] hover:bg-[#0088cc]/90 text-white",children:[e.jsx(k,{className:"w-4 h-4"}),"Telegram bot bilan ulash"]})})]}),e.jsxs(g.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"p-4 rounded-xl bg-primary/5 border border-primary/10",children:[e.jsx("h4",{className:"font-medium text-sm text-primary mb-2",children:"ðŸ“± Telegram bot haqida"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"â€¢ So'zlarni takrorlash eslatmalari"}),e.jsx("li",{children:"â€¢ Statistika va streak ma'lumotlari"}),e.jsx("li",{children:"â€¢ Bot orqali bildirishnomalarni sozlash"}),e.jsx("li",{children:"â€¢ /menu - barcha buyruqlarni ko'rish"})]})]})]})})};export{Me as default};
